ВНИМАНИЕ!!! ЭТО УСТАРЕВШАЯ ВЕРСИЯ МАНУАЛА ПО НАСТРОЙКЕ!!!


## Настройка
### Предварительная настройка

В начале рекомендую ознакомиться с [общими правилами настройки OpenIPC](https://github.com/OpenIPC/wiki/blob/master/ru/configuration.md#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-openipc)

Предварительная настройка камеры MJSXJ03HL отличается от настройки большинства камер. В данный момент камера не может подключиться к интернету и использовать SSH мы не можем. Также не можем использовать WEB-интерфейс. Поэтому все команды пока будут выполняться в терминальном доступе к камере. Синтаксис команд в этом случае не отличается.

#### Подгрузка драйвера

В первую очередь необходимо вручную добавить драйвер для беспроводного модуля.

Драйвер, с которым у меня удалось настроить сеть можно загрузить по [ссылке](https://github.com/OpenIPC/device-mjsxj03hl/raw/master/flash/autoconfig/lib/modules/rtl8189ftv.ko)

Скопируйте драйвер на SD карту, поместите ее в память камеры, подключите UART, терминал, подайте напряжение. Войдите в консоль камеры (не U-Boot!)
Авторизуйтесь и введите следующие команды:
1. Идем на флешку
```
cd /mnt/mmcblk0p1
``` 
2. Убеждаемся что файл присутствует
```
ls -l
```
3. Копируем
```
cp rtl8189ftv.ko /lib/modules/3.10.14__isvp_swan_1.0__/extra
```
Пока нет смысла перезагружать и проверять работу сети, переходим к следующему этапу 
#### Конфигурация сети
Сетевая конфигурация у нас расположена в файле /etc/network/interfaces
К сожалению, из текстовых редакторов доступен только `vi` Рекомендую предварительно ознакомиться с нюансами работы данного редактора.

Скомандуем 
``` 
vi /etc/network/interfaces.d/wlan0
```
И приведем его содержимое к виду:

```
auto wlan0
iface wlan0 inet dhcp
    pre-up modprobe mac80211
    pre-up modprobe cfg80211
    pre-up insmod /lib/modules/3.10.14__isvp_swan_1.0__/extra/rtl8189ftv.ko
    pre-up wpa_passphrase "SSID" "PASSWORD" >/tmp/wpa_supplicant.conf
    pre-up sed -i '2i \\tscan_ssid=1' /tmp/wpa_supplicant.conf
    pre-up sleep 1
    pre-up wpa_supplicant -B -D nl80211 -i wlan0 -c/tmp/wpa_supplicant.conf
    post-down killall -q wpa_supplicant

```


Сохраните изменения (убедитесь что вы все сделали верно) и перезагрузите камеру. Сеть должна появиться. Войдите в веб-интерфейс и выполните настройки, как описано в [статье](https://github.com/OpenIPC/wiki/blob/master/ru/configuration.md#%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF-%D0%B2-%D0%B2%D0%B5%D0%B1-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81).

Помимо этого в веб-интерфейсе войдите в секцию _Majestic --> ISP_ и выставите параметр **Block count** со значением **1**

#### Чиним Majestic Streamer

Войдите в консоль камеры по SSH или через UART. О том, как использовать SSH написано [здесь](https://github.com/OpenIPC/wiki/blob/master/ru/configuration.md#%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF-%D0%B2-%D1%88%D0%B5%D0%BB%D0%BB)

Для начала отключим HLS и зададим значение Block count. _Команды вводятся построчно!_
```
cli -s .hls.enabled false
cli -s .isp.blkCnt 1
```
Затем задайте некоторые переменные:
```
fw_setenv osmem 39M
fw_setenv rmem 25M@0x2700000
```
И затем перезагружаем: `reboot`
Теперь видео должно заработать.

#### Прописываем путь к накопителю
В веб-интерфейсе выбираем Majestic --> Recording и прописываем туда путь к вашей карте, то есть в нашем случае приводим поле к виду:
```
/mnt/mmcblk0p1/%Y/%m/%d/%H.mp4
```
Перезагружаем и убеждаемся, что камера записывает видео на карту памяти.

#### Ночной режим
Настройте ночной режим, как показано на скриншоте. Обратите внимание на значения полей! 
![photo_2023-03-12_21-16-53](https://user-images.githubusercontent.com/88727968/224554161-4f69f333-c3ef-4ed0-8f04-5c504bec5009.jpg)
